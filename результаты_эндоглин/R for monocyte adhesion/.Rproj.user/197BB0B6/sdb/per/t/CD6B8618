{
    "collab_server" : "",
    "contents" : "\nlibrary(stringr)\nlibrary(ggplot2)\nlibrary(lmerTest)\n\npath <- \"D:/Google Drive/материалы для отчета по гранту/adhesion_THP1_U937/Илья/\"\nsetwd(path)\n\n## ----The Theme-----------------------------------------------------------------------------------\n\nsource(\"D:/Google Drive/материалы для статьи функциональные тесты/Figure_theme.R\")\n\n## ----Constants-----------------------------------------------------------------------------------\n\nMAbs <- c(\"control\", \"3A7\", \"2C8\", \"4C9\", \"4E4\", \"5H7\")\n\n## ----Fucntions-----------------------------------------------------------------------------------\n\nread_file <- function(filename) {\n        df <- read.csv(file = filename, sep = \";\", dec = \",\")\n        df$exp <- basename(filename)\n        df\n}\n\nread_files <- function(path = getwd(), files) {\n        do.call(rbind, lapply(file.path(path, files), read_file))\n}\n\nstrip_filename <- function(filename) {\n        stripped <- str_remove(str_remove(filename, \"report_\"), \".csv\")\n        stripped\n}\n\nread_data <- function(files) {\n        df <- read_files(files = files)\n        df$mab <- strip_filename(df$file)\n        df$mab <- factor(df$mab, levels = MAbs)\n        df\n}\n\ncontrast_readable <- function(contrasts, round) {\n        df <- data.frame(Contrasts = contrasts$contrasts$Contrast,\n                         p.value = round(contrasts$contrasts$p.value, round))\n        df\n}\n\ntext_to_df <- function(text){\n        read.table(textConnection(text), header = T)\n}\n\n## ----Data----------------------------------------------------------------------------------------\n\nTHP.files <- list.files(\"Short incubation/THP-1/\", pattern = \"*.csv\", full.names = T)\nTHP_short <- read_data(THP.files)\n\nU937.files <- list.files(\"Short incubation/U937/\", pattern = \"*.csv\", full.names = T)\nU937_short <- read_data(U937.files)\n\n## ----Raw data figures (Short incubation)---------------------------------------------------------\n\nggplot(THP_short, aes(mab, left.circles)) +\n        geom_jitter(aes(color = exp), width = 0.15, size = 2.5, alpha = 0.75) +\n        theme_bw()\n\n\nggplot(U937_short, aes(mab, left.circles)) +\n        geom_jitter(aes(color = exp), width = 0.15, size = 2.5, alpha = 0.75) +\n        theme_bw()\n\n## ----Statistics----------------------------------------------------------------------------------\n\n#       THP-1 short incubation\n\nTHP_short.model <- glmer(left.circles ~ mab + (1|exp), data = THP_short, family = \"poisson\")\n\nsummary(THP_short.model)\nplot(THP_short.model)\n\nTHP_short_contr <- psycho::get_contrasts(THP_short.model, formula = \"mab\", adjust = \"bonferroni\")\ncontrast_readable(THP_short_contr, 5)\n\nTHP_short_result <- \ndata.frame(\n        mab = THP_short_contr$means$mab,\n        mean = exp(THP_short_contr$means$Mean),\n        CI.lower = exp(THP_short_contr$means$CI_lower),\n        CI.upper = exp(THP_short_contr$means$CI_higher))\n\nTHP_short_result$mab <- factor(THP_short_result$mab, levels = MAbs)\n\n\n#       U937 short incubation\n\nU937_short.model <- glm(left.circles ~ mab, U937_short, family = \"poisson\")\n\nsummary(U937_short.model)\n\ncontrast::contrast(U937_short.model, list(\"mab\"))\n\nsummary(multcomp::glht(U937_short.model, mcp(rank=\"Tukey\")))\n\n## ----Figures-------------------------------------------------------------------------------------\n\n#       THP-1 short incubation\n\nTHP_short_lines <-\ntext_to_df(\n\"line  path     y\n    1     1  1800\n    1     2  1800\n    2     2  2000\n    2     6  2000\n    3     2  1950\n    3     5  1950\n    4     2  1900\n    4     4  1900\")\n\nTHP_short_stars <-\ntext_to_df(\n\"  x    y stars\n 1.5 1850   ***\n 3.0 2050   ***\"\n)\n\nfig_THP_short <-\nggplot(THP_short_result, aes(mab, mean)) +\n        geom_bar(stat = \"identity\", width = 0.45, color = \"black\", fill = \"grey\") +\n        geom_errorbar(width = 0.25, aes(ymin = CI.lower, ymax = CI.upper)) +\n        geom_line(data = THP_short_lines, aes(path, y, group = line)) +\n        geom_text(data = THP_short_stars, aes(x, y, label = stars), size = 7) +\n        my_theme +\n        theme(plot.title = element_text(hjust = 0.5, face = \"bold\")) +\n        ggtitle(\"THP-1\")\n\nfig_THP_short_rus <- fig_THP_short +\n        scale_x_discrete(labels = c(\"К\", \"IgG1\", \"2C8\", \"4C9\", \"4E4\", \"5H7\")) +\n        labs(x = \"\", y = \"Кол-во прикрепившихся клеток\")\n\nfig_THP_short_eng <- fig_THP_short +\n        scale_x_discrete(labels = c(\"Control\", \"IgG1\", \"2C8\", \"4C9\", \"4E4\", \"5H7\")) +\n        labs(x = \"\", y = \"Number of cells attached\")\n\n\n\n",
    "created" : 1539774657978.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "995131293",
    "id" : "CD6B8618",
    "lastKnownWriteTime" : 1539331679,
    "last_content_update" : 1539331679,
    "path" : "D:/Анастасия Столбовая/результаты_эндоглин/R for monocyte adhesion/adhesion_to_cells.R",
    "project_path" : "adhesion_to_cells.R",
    "properties" : {
    },
    "relative_order" : 10,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}